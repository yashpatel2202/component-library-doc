import { ArchitectureGraph } from "@/components/ArchitectureGraph";
import { DocStatus } from "@/components/DocStatus";

<DocStatus status="waiting" />

# API Integration Component

## 1. Requirements Document

### Overview

A high-level wrapper that utilizes the Core HTTP Client to provide a standardized way of defining API endpoints, handling request/response mapping, and managing specific API feature sets (like pagination or file uploads) with minimal boilerplate.

### User Stories

- **As a Developer**, I want to define an API endpoint by just providing the path and response type.
- **As a Developer**, I want automatic error parsing (e.g., converting "400 Bad Request" JSON to a domain error object).
- **As a Developer**, I want built-in support for paginated lists without rewriting the scroll logic.

### Functional Requirements

1.  **Endpoint Definition**: Declarative style for defining GET/POST/PUT/DELETE requests.
2.  **Response Parsing**: Automatic serialization of JSON to Dart models using `fromJson` factories.
3.  **Pagination Wrapper**: A standardized response container for paged data (`data`, `meta`, `links`).
4.  **Error Transformation**: Middleware to convert raw HTTP errors into user-friendly domain exceptions.

---

## 2. Technical Document

### Architecture

<ArchitectureGraph
  diagram={`graph LR
    %% Styles
    classDef core fill:#3b82f6,stroke:#2563eb,stroke-width:2px,color:white,rx:10,ry:10;
    classDef wrapper fill:#f8fafc,stroke:#e2e8f0,stroke-width:1px,color:#334155,rx:8,ry:8;
    classDef storage fill:#f0fdf4,stroke:#86efac,stroke-width:2px,color:#166534,rx:8,ry:8;

    %% Nodes
    subgraph App [Feature Layer]
        direction TB
        Repo[UserRepository]:::wrapper
    end

    subgraph Wrapper [Integration Wrapper]
        direction TB
        Base[Base<br/>API]:::core
        Parser[Response<br/>Parser]:::core
    end

    subgraph Core [Core Library]
        direction TB
        Http[HTTP<br/>Client]:::storage
    end

    %% Connections
    Repo -->|Inherit| Base
    Base -->|Call| Http
    Http -->|Raw Response| Base
    Base -->|Decode| Parser`}

description={

<>
<p>
The <strong>API Integration Wrapper</strong> serves as the base class for all repositories. It abstracts
the direct usage of the HTTP client, enforcing a standard pattern for data fetching and error handling
across the entire app.
</p>
</>
}
/>

### API Design

#### Base API Usage

```dart
class UserApi extends BaseApi {
  UserApi(super.client);

  Future<Result<User>> getUser(String id) {
    return get<User>(
      path: '/users/$id',
      decoder: (json) => User.fromJson(json),
    );
  }

  Future<Result<PagedList<User>>> getUsers(int page) {
    return getPaged<User>(
      path: '/users',
      query: {'page': page},
      decoder: (json) => User.fromJson(json),
    );
  }
}
```

#### Pagination Config

```dart
class PagedList<T> {
  final List<T> items;
  final int total;
  final bool hasNext;
  // ...
}
```
